## ğŸ”´ The Problem

When a user downloads a large file, the server needs 10-120 seconds to process it. But proxies like Cloudflare have a 100-second timeout. If processing takes longer, the connection dies.

```
                    âŒ THE PROBLEM: Synchronous Download
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚   User clicks "Download"                                                â”‚
    â”‚          â”‚                                                              â”‚
    â”‚          â–¼                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚   â”‚  Browser â”‚ â”€â”€â”€â–º â”‚ Cloudflare  â”‚ â”€â”€â”€â–º â”‚ API Server  â”‚                â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ (100s limit)â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
    â”‚          â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                       â”‚
    â”‚          â”‚                â”‚                     â”‚                       â”‚
    â”‚     Waiting...      TIMEOUT!           Still working...                 â”‚
    â”‚          â”‚                â”‚                     â”‚                       â”‚
    â”‚          â–¼                â–¼                     â–¼                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚   â”‚  Error!  â”‚ â—„â”€â”€â”€ â”‚ Connection  â”‚      â”‚   Done!     â”‚                â”‚
    â”‚   â”‚   504    â”‚      â”‚    Cut      â”‚      â”‚ (too late)  â”‚                â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
    â”‚                                                                         â”‚
    â”‚   Result: User gets error, server wasted work, file never delivered     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Timeout Reality

| Layer      | Timeout |     Can We Change It?     |
| :--------- | :-----: | :-----------------------: |
| Cloudflare |  100s   | âŒ No (unless Enterprise) |
| AWS ALB    |   60s   |        âš ï¸ Limited         |
| nginx      |   60s   |          âœ… Yes           |
| Browser    | Varies  |           âŒ No           |

**Bottom line:** We can't control proxy timeouts, so we must work around them.

---

## âœ… Our Solution

Instead of making the user wait, we:

1. **Return a job ID instantly** (< 100ms)
2. **Process in the background**
3. **Push updates via SSE** (with polling fallback)

```
                           âœ… OUR SOLUTION: Async Download
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                         â”‚
    â”‚   User clicks "Download"                                                â”‚
    â”‚          â”‚                                                              â”‚
    â”‚          â–¼                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚   â”‚  Browser â”‚ â”€â”€â”€â–º â”‚ Cloudflare  â”‚ â”€â”€â”€â–º â”‚ API Server  â”‚               â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚          â”‚                                      â”‚                       â”‚
    â”‚          â”‚â—„â”€â”€â”€â”€ { job_id: "abc-123" } â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
    â”‚          â”‚         (< 100ms!)                                           â”‚
    â”‚          â”‚                                                              â”‚
    â”‚          â–¼                                      â–¼                       â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚   â”‚ Subscribeâ”‚                           â”‚   Worker    â”‚               â”‚
    â”‚   â”‚ to SSE   â”‚                           â”‚ (background)â”‚               â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚          â”‚                                      â”‚                       â”‚
    â”‚          â”‚â—„â”€â”€â”€â”€ Progress: 33% â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚          â”‚â—„â”€â”€â”€â”€ Progress: 67% â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚          â”‚â—„â”€â”€â”€â”€ Progress: 100% â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚          â”‚â—„â”€â”€â”€â”€ Completed! {url} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
    â”‚          â”‚                                                              â”‚
    â”‚          â–¼                                                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
    â”‚   â”‚ Download â”‚ â”€â”€â”€â–º â”‚  MinIO S3   â”‚                                    â”‚
    â”‚   â”‚  File    â”‚      â”‚  (storage)  â”‚                                    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
    â”‚                                                                         â”‚
    â”‚   Result: User gets file, no timeout, real-time progress âœ…            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ Architecture Diagram

### System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SYSTEM ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚    â”‚   ğŸ‘¤ CLIENT     â”‚                                                          â”‚
â”‚    â”‚  React Frontend â”‚                                                          â”‚
â”‚    â”‚     :5173       â”‚                                                          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚             â”‚                                                                    â”‚
â”‚             â”‚ HTTPS                                                              â”‚
â”‚             â–¼                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚    â”‚  ğŸŒ PROXY       â”‚                                                          â”‚
â”‚    â”‚   Cloudflare    â”‚â—„â”€â”€â”€ 100s timeout (we respond in <100ms)                  â”‚
â”‚    â”‚   or nginx      â”‚                                                          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚             â”‚                                                                    â”‚
â”‚             â–¼                                                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚    â”‚   âš¡ API        â”‚         â”‚ ğŸ“Š OBSERVABILITYâ”‚                              â”‚
â”‚    â”‚  Hono Server    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Jaeger :16686  â”‚                              â”‚
â”‚    â”‚     :3000       â”‚         â”‚  Sentry         â”‚                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚             â”‚                                                                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚      â”‚             â”‚                                                            â”‚
â”‚      â–¼             â–¼                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚
â”‚ â”‚ğŸ“‹ QUEUE â”‚  â”‚ ğŸ“ JOB   â”‚                                                      â”‚
â”‚ â”‚SimpleQ  â”‚  â”‚  STORE    â”‚â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚ â”‚FIFO     â”‚  â”‚ In-Memory â”‚       â”‚ SSE Events                                   â”‚
â”‚ â”‚Conc: 5  â”‚  â”‚ EventEmit â”‚       â”‚                                              â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                                              â”‚
â”‚      â”‚                           â”‚                                              â”‚
â”‚      â–¼                           â–¼                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚ â”‚âš™ï¸ WORKERâ”‚              â”‚   ğŸ‘¤ CLIENT     â”‚                                    â”‚
â”‚ â”‚Backgroundâ”‚             â”‚ (receives SSE)  â”‚                                    â”‚
â”‚ â”‚Processor â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                     â”‚
â”‚      â”‚                                                                          â”‚
â”‚      â–¼                                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                             â”‚
â”‚ â”‚  ğŸ’¾ STORAGE     â”‚                                                             â”‚
â”‚ â”‚   MinIO S3      â”‚                                                             â”‚
â”‚ â”‚  :9000 / :9001  â”‚                                                             â”‚
â”‚ â”‚                 â”‚                                                             â”‚
â”‚ â”‚ â€¢ Store files   â”‚                                                             â”‚
â”‚ â”‚ â€¢ Presigned URLsâ”‚                                                             â”‚
â”‚ â”‚ â€¢ 1hr expiry    â”‚                                                             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                             â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Flow (Sequence)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚          â”‚   API   â”‚          â”‚ Queue â”‚          â”‚ Worker â”‚          â”‚  S3   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚ 1. POST /async     â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚ 2. Enqueue job    â”‚                  â”‚                   â”‚
    â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚ 3. {job_id}        â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                   â”‚                  â”‚                   â”‚
    â”‚    (<100ms!)       â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚ 4. Subscribe SSE   â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚ 5. Dequeue       â”‚                   â”‚
    â”‚                    â”‚                   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚ 6. Process files  â”‚
    â”‚                    â”‚                   â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚ 7. SSE: 33%        â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡                   â”‚
    â”‚ 8. SSE: 67%        â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡                   â”‚
    â”‚ 9. SSE: 100%       â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚ 10. Upload        â”‚
    â”‚                    â”‚                   â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚ 11. Presigned URL â”‚
    â”‚                    â”‚                   â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚ 12. SSE: {url}     â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡                   â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
    â”‚ 13. Download file  â”‚                   â”‚                  â”‚                   â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
    â”‚                    â”‚                   â”‚                  â”‚                   â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”´â”€â”€â”€â”          â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”´â”€â”€â”€â”
â”‚ Client â”‚          â”‚   API   â”‚          â”‚ Queue â”‚          â”‚ Worker â”‚          â”‚  S3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Job State Machine

```
                              JOB LIFECYCLE
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                 â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
    â”‚        POST /async â”€â”€â–º â”‚  QUEUED  â”‚                             â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                             â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â”‚ Worker picks up                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
    â”‚                        â”‚  PROCESSING  â”‚â—„â”€â”€â”€â”€â”€â”                  â”‚
    â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚                  â”‚
    â”‚                                â”‚             â”‚                  â”‚
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚
    â”‚                    â”‚           â”‚           â”‚ â”‚ Retry            â”‚
    â”‚                    â–¼           â–¼           â–¼ â”‚ (max 3)          â”‚
    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚              â”‚  READY  â”‚ â”‚  ERROR  â”‚â”€â”˜         â”‚                â”‚
    â”‚              â”‚   âœ…    â”‚ â”‚   âš ï¸    â”‚           â”‚                â”‚
    â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â”‚                â”‚
    â”‚                               â”‚                â”‚                â”‚
    â”‚                               â”‚ Max retries    â”‚                â”‚
    â”‚                               â–¼                â”‚                â”‚
    â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                â”‚
    â”‚                         â”‚  FAILED  â”‚           â”‚                â”‚
    â”‚                         â”‚    âŒ    â”‚           â”‚                â”‚
    â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                â”‚
    â”‚                                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤” Why This Approach?

### The Four Options We Considered

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PATTERN COMPARISON                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   OPTION A: POLLING ONLY              OPTION B: SSE ONLY                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                                                                  â”‚
â”‚   Client        Server                Client        Server                      â”‚
â”‚      â”‚            â”‚                      â”‚            â”‚                         â”‚
â”‚      â”‚â”€â”€Requestâ”€â”€â–ºâ”‚                      â”‚â”€â”€Subscribeâ”€â–ºâ”‚                         â”‚
â”‚      â”‚â—„â”€Responseâ”€â”€â”‚                      â”‚             â”‚                         â”‚
â”‚      â”‚   wait 2s  â”‚                      â”‚â—„â”€â”€Event 1â”€â”€â”€â”‚                         â”‚
â”‚      â”‚â”€â”€Requestâ”€â”€â–ºâ”‚                      â”‚â—„â”€â”€Event 2â”€â”€â”€â”‚                         â”‚
â”‚      â”‚â—„â”€Responseâ”€â”€â”‚                      â”‚â—„â”€â”€Event 3â”€â”€â”€â”‚                         â”‚
â”‚      â”‚   wait 2s  â”‚                      â”‚â—„â”€â”€Doneâ”€â”€â”€â”€â”€â”€â”‚                         â”‚
â”‚      â”‚â”€â”€Requestâ”€â”€â–ºâ”‚                      â”‚             â”‚                         â”‚
â”‚      â”‚   ...      â”‚                                                              â”‚
â”‚                                                                                  â”‚
â”‚   âŒ Wastes bandwidth                 âŒ May not work behind                    â”‚
â”‚   âŒ Delayed updates                     strict proxies                         â”‚
â”‚   âœ… Works everywhere                 âœ… Real-time                               â”‚
â”‚                                                                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                                  â”‚
â”‚   OPTION C: WEBHOOK                   OPTION D: HYBRID (OURS) âœ…                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚                                                                                  â”‚
â”‚   Client        Server                Client        Server                      â”‚
â”‚      â”‚            â”‚                      â”‚            â”‚                         â”‚
â”‚      â”‚â”€â”€Requestâ”€â”€â–ºâ”‚                      â”‚â”€â”€Requestâ”€â”€â–ºâ”‚                         â”‚
â”‚      â”‚ {callback} â”‚                      â”‚â—„â”€â”€job_idâ”€â”€â”€â”‚  (<100ms)               â”‚
â”‚      â”‚            â”‚                      â”‚            â”‚                         â”‚
â”‚      â”‚   ...      â”‚                      â”‚â”€â”€Try SSEâ”€â”€â–ºâ”‚                         â”‚
â”‚      â”‚            â”‚                      â”‚â—„â”€â”€Eventsâ”€â”€â”€â”‚  (if works)             â”‚
â”‚      â”‚â—„â”€Callbackâ”€â”€â”‚                      â”‚            â”‚                         â”‚
â”‚                                          â”‚â”€â”€OR Pollâ”€â”€â–ºâ”‚  (fallback)             â”‚
â”‚   âŒ Client needs server              â”‚â—„â”€â”€Statusâ”€â”€â”€â”‚                         â”‚
â”‚   âŒ Complex setup                       â”‚            â”‚                         â”‚
â”‚   âœ… Efficient                                                                   â”‚
â”‚                                       âœ… Real-time when possible                â”‚
â”‚                                       âœ… Works everywhere                        â”‚
â”‚                                       âœ… Graceful degradation                    â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Decision Matrix

| Requirement             | Polling | SSE Only | Webhook | **Hybrid** âœ… |
| :---------------------- | :-----: | :------: | :-----: | :-----------: |
| Works behind Cloudflare |   âœ…    |    âš ï¸    |   âœ…    |      âœ…       |
| Real-time updates       |   âŒ    |    âœ…    |   âœ…    |      âœ…       |
| Browser-only client     |   âœ…    |    âœ…    |   âŒ    |      âœ…       |
| Simple implementation   |   âœ…    |    âœ…    |   âŒ    |      âœ…       |
| No wasted requests      |   âŒ    |    âœ…    |   âœ…    |      âœ…       |
| Graceful degradation    |   N/A   |    âŒ    |   âŒ    |      âœ…       |

**Winner: Hybrid** â€” Gets real-time updates when possible, falls back to polling when needed.

---

## â“ What If We Used Other Approaches?

### âŒ Synchronous (No Queue)

```
What happens:
â”œâ”€â”€ User clicks download
â”œâ”€â”€ Server starts processing
â”œâ”€â”€ 60 seconds pass...
â”œâ”€â”€ Cloudflare: "Timeout!" ğŸ’€
â”œâ”€â”€ User sees 504 error
â”œâ”€â”€ User refreshes â†’ creates DUPLICATE job
â”œâ”€â”€ Server overloaded
â””â”€â”€ User never gets file
```

### âŒ Polling Only

```
What happens:
â”œâ”€â”€ 30 requests for a 60-second job
â”œâ”€â”€ 2-second delay before seeing "done"
â”œâ”€â”€ Server handles unnecessary load
â”œâ”€â”€ Mobile users waste data
â””â”€â”€ Works, but inefficient
```

### âŒ SSE Only (No Fallback)

```
What happens:
â”œâ”€â”€ Corporate proxy blocks SSE
â”œâ”€â”€ User gets no updates
â”œâ”€â”€ No way to know if it's working
â”œâ”€â”€ User refreshes (duplicate job)
â””â”€â”€ Poor experience for some users
```

### âœ… Our Hybrid

```
What happens:
â”œâ”€â”€ Try SSE first
â”œâ”€â”€ If SSE works â†’ real-time updates
â”œâ”€â”€ If SSE fails â†’ automatic polling fallback
â”œâ”€â”€ All users get updates
â””â”€â”€ Everyone gets their file âœ…
```

---

## âš–ï¸ Pros and Cons

### âœ… Advantages

| Benefit                   | Explanation                              |
| :------------------------ | :--------------------------------------- |
| **ğŸš€ No Timeouts**        | Response in <100ms beats any proxy limit |
| **ğŸ“Š Real-time Progress** | Users see 33% â†’ 67% â†’ 100% live          |
| **ğŸ”„ Resilient**          | Server restart doesn't kill downloads    |
| **ğŸ“ˆ Scalable**           | Add workers to handle more jobs          |
| **ğŸ›¡ï¸ Universal**          | Works for all users (SSE or polling)     |
| **ğŸ” Observable**         | Full tracing with Jaeger                 |

### âŒ Limitations

| Limitation           | Our Mitigation             |
| :------------------- | :------------------------- |
| **In-memory queue**  | Use Redis in production    |
| **More complex**     | Worth it for reliability   |
| **SSE proxy issues** | Automatic polling fallback |
| **No auth**          | Add JWT in production      |

---

## ğŸ”§ Implementation Details

### API Endpoints

| Method | Endpoint                     | Purpose      | Response                   |
| :----- | :--------------------------- | :----------- | :------------------------- |
| `POST` | `/v1/download/async`         | Start job    | `{job_id}` in <100ms       |
| `GET`  | `/v1/download/status/:id`    | Poll status  | `{status, progress, url?}` |
| `GET`  | `/v1/download/subscribe/:id` | SSE stream   | Real-time events           |
| `GET`  | `/health`                    | Health check | `{api, storage}`           |

### Data Schemas

```typescript
// Request
interface DownloadRequest {
  file_ids: number[]; // [101, 102, 103]
}

// Job Status Response
interface JobStatus {
  job_id: string; // "abc-123"
  status: "queued" | "processing" | "ready" | "failed";
  progress: number; // 0-100
  total_files: number; // 3
  processed_files: number; // 2
  download_url?: string; // When ready
  error?: string; // When failed
}

// SSE Events
type SSEEvent =
  | { type: "progress"; data: { progress: number } }
  | { type: "completed"; data: { download_url: string } }
  | { type: "failed"; data: { error: string } };
```

### Queue Configuration

| Setting     | Value        | Purpose                           |
| :---------- | :----------- | :-------------------------------- |
| Type        | FIFO         | First-in-first-out processing     |
| Concurrency | 5            | Process 5 jobs simultaneously     |
| Retries     | 3            | Retry failed jobs 3 times         |
| Backoff     | 1s â†’ 2s â†’ 4s | Exponential delay between retries |

### Error Handling

```
                    ERROR HANDLING FLOW
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                 â”‚
    â”‚   Job received                                  â”‚
    â”‚        â”‚                                        â”‚
    â”‚        â–¼                                        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
    â”‚   â”‚ Process â”‚                                   â”‚
    â”‚   â”‚  file   â”‚                                   â”‚
    â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                   â”‚
    â”‚        â”‚                                        â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                   â”‚
    â”‚   â”‚         â”‚                                   â”‚
    â”‚   â–¼         â–¼                                   â”‚
    â”‚ Success?  Failed?                               â”‚
    â”‚   â”‚         â”‚                                   â”‚
    â”‚   â”‚         â”œâ”€â”€â–º Retry < 3? â”€â”€â–º Wait & retry   â”‚
    â”‚   â”‚         â”‚                                   â”‚
    â”‚   â”‚         â””â”€â”€â–º Retry = 3? â”€â”€â–º Mark FAILED    â”‚
    â”‚   â”‚                                             â”‚
    â”‚   â””â”€â”€â–º More files? â”€â”€â–º Process next            â”‚
    â”‚              â”‚                                  â”‚
    â”‚              â””â”€â”€â–º Done â”€â”€â–º Upload to S3        â”‚
    â”‚                              â”‚                  â”‚
    â”‚                              â””â”€â”€â–º Mark READY   â”‚
    â”‚                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Proxy Configuration

### Timeout Strategy

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     TIMEOUT CONFIGURATION                        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                  â”‚
    â”‚   Layer            Timeout      Our Response Time                â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
    â”‚   Cloudflare       100s         <100ms âœ…                       â”‚
    â”‚   nginx            60s          <100ms âœ…                       â”‚
    â”‚   API Request      30s          <100ms âœ…                       â”‚
    â”‚   SSE Connection   âˆ            Streaming âœ…                    â”‚
    â”‚   Presigned URL    1 hour       N/A                             â”‚
    â”‚                                                                  â”‚
    â”‚   âœ… We respond BEFORE any timeout can trigger                  â”‚
    â”‚                                                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### nginx Configuration

```nginx
# SSE endpoints - no buffering, long timeout
location /v1/download/subscribe/ {
    proxy_pass http://api:3000;
    proxy_buffering off;           # Don't buffer SSE
    proxy_cache off;               # Don't cache
    proxy_read_timeout 3600s;      # 1 hour for long jobs
    proxy_set_header Connection "";
}

# Regular API - standard timeout
location /v1/download/ {
    proxy_pass http://api:3000;
    proxy_read_timeout 30s;        # Quick (we respond fast)
}
```

### Cloudflare Settings

| Setting    | Value        | Why                       |
| :--------- | :----------- | :------------------------ |
| WebSockets | âœ… On        | Required for SSE          |
| Cache      | Bypass       | Don't cache API responses |
| Timeout    | 100s (fixed) | We work around it         |

---

## ğŸš€ Future Improvements

| Priority  | Improvement   | Benefit               |
| :-------- | :------------ | :-------------------- |
| ğŸ”´ High   | Redis Queue   | Jobs survive restarts |
| ğŸ”´ High   | JWT Auth      | Secure API access     |
| ğŸŸ¡ Medium | Rate Limiting | Prevent abuse         |
| ğŸŸ¡ Medium | Cancel API    | Users can abort jobs  |
| ğŸŸ¢ Low    | WebSocket     | Bi-directional comms  |
| ğŸŸ¢ Low    | Kubernetes    | Auto-scaling          |

### Scaling Path

```
    CURRENT (Hackathon)                    PRODUCTION (Future)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API â”‚â”€â”€â–ºâ”‚ Queue â”‚â”€â”€â–ºâ”‚ Worker â”‚      â”‚    Load Balancer     â”‚
    â”‚ (1) â”‚   â”‚(memory)â”‚  â”‚  (1)   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚                     â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼         â–¼         â–¼
              MinIO (1)                â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”
                                       â”‚API 1â”‚   â”‚API 2â”‚   â”‚API Nâ”‚
    Throughput: ~5 jobs                â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚    Redis     â”‚
                                          â”‚   (BullMQ)   â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
                                          â–¼      â–¼      â–¼
                                       â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”
                                       â”‚ W1 â”‚ â”‚ W2 â”‚ â”‚ WN â”‚
                                       â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜
                                          â”‚      â”‚      â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                                                 â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  S3 Cluster  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                       Throughput: N Ã— 5 jobs
```

---

## ğŸ“Š Summary

| Question                  | Answer                                    |
| :------------------------ | :---------------------------------------- |
| **What problem?**         | Downloads timeout after 60-100s           |
| **Your solution?**        | Async processing, return job ID instantly |
| **Why hybrid?**           | SSE for speed + polling for compatibility |
| **Why not polling only?** | Wastes bandwidth, delayed updates         |
| **Why not SSE only?**     | Some proxies block it                     |
| **Main pros?**            | No timeouts, real-time, scalable          |
| **Main cons?**            | In-memory state (use Redis in prod)       |
| **Future?**               | Redis, auth, rate limiting                |

---

    CURRENT (Hackathon)                    PRODUCTION (Future)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API â”‚â”€â”€â–ºâ”‚ Redis â”‚â”€â”€â–ºâ”‚ Worker â”‚      â”‚    Load Balancer     â”‚
    â”‚ (1) â”‚   â”‚ Queue â”‚   â”‚  (1)   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚                     â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼         â–¼         â–¼
              MinIO (1)                â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”
                                       â”‚API 1â”‚   â”‚API 2â”‚   â”‚API Nâ”‚
    Throughput: ~5 jobs                â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”˜
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  Redis (Q)   â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
                                          â–¼      â–¼      â–¼
                                       â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”
                                       â”‚ W1 â”‚ â”‚ W2 â”‚ â”‚ WN â”‚
                                       â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜
                                          â”‚      â”‚      â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                                                 â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  S3 Cluster  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                       Throughput: N Ã— 5 jobs
